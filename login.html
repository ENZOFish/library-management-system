<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ - æ¼”ç¤ºSQLæ³¨å…¥æ¼æ´çš„æ•™å­¦é¡¹ç›®">
    <title>å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .login-container {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .form-box {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .form-box h2 {
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn-register {
            background: #764ba2;
        }
        
        .btn-register:hover {
            background: #6a4290;
        }
        
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .main-interface {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        
        .welcome {
            font-size: 1.5em;
            color: #333;
        }
        
        .role-badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .info-card h4 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .info-card p {
            color: #666;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ</h1>
            <p>æ¬¢è¿ä½¿ç”¨å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿï¼Œè¯·ç™»å½•æˆ–æ³¨å†Œæ–°è´¦æˆ·</p>
        </div>
        
        <div class="login-container" id="loginSection">
            <div class="form-box">
                <h2>ç”¨æˆ·ç™»å½•</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">ç”¨æˆ·å</label>
                        <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">å¯†ç </label>
                        <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <button type="button" class="btn" onclick="login()">ç™»å½•</button>
                </form>
                <div id="loginMessage" class="message"></div>
            </div>
            
            <div class="form-box">
                <h2>ç”¨æˆ·æ³¨å†Œ</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">ç”¨æˆ·å</label>
                        <input type="text" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">å¯†ç </label>
                        <input type="password" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">é‚®ç®±</label>
                        <input type="email" id="regEmail" placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                    </div>
                    <button type="button" class="btn btn-register" onclick="register()">æ³¨å†Œ</button>
                </form>
                <div id="registerMessage" class="message"></div>
            </div>
        </div>
        
        <div class="main-interface" id="mainInterface">
            <div class="user-header">
                <div>
                    <div class="welcome" id="welcomeMessage">æ¬¢è¿å›æ¥ï¼Œç”¨æˆ·ï¼</div>
                    <div class="role-badge" id="userRole">æ™®é€šç”¨æˆ·</div>
                </div>
                <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
            
            <h2>å›¾ä¹¦é¦†ç®¡ç†é¢æ¿</h2>
            <p>æ‚¨å·²æˆåŠŸç™»å½•å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ</p>
            
            <div class="system-info">
                <div class="info-card">
                    <h4>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h4>
                    <p>å›¾ä¹¦æ€»æ•°ï¼š<strong id="bookCount">0</strong> æœ¬</p>
                    <p>å€Ÿé˜…äººæ•°ï¼š<strong id="borrowCount">0</strong> äºº</p>
                    <p>åœ¨å€Ÿå›¾ä¹¦ï¼š<strong id="activeBorrow">0</strong> æœ¬</p>
                </div>
                
                <div class="info-card">
                    <h4>â° æœ€è¿‘æ´»åŠ¨</h4>
                    <p>â€¢ æ‚¨æœ€è¿‘å€Ÿé˜…äº†ã€ŠWebå®‰å…¨åŸºç¡€ã€‹</p>
                    <p>â€¢ æ–°ä¹¦ã€ŠSQLæ³¨å…¥ä¸é˜²å¾¡ã€‹å·²ä¸Šæ¶</p>
                    <p>â€¢ ç³»ç»Ÿç»´æŠ¤ï¼šæ¯å‘¨æ—¥ 2:00-4:00</p>
                </div>
                
                <div class="info-card">
                    <h4>ğŸ” å®‰å…¨æç¤º</h4>
                    <p>â€¢ è¯·å®šæœŸä¿®æ”¹å¯†ç </p>
                    <p>â€¢ ä¸è¦ä½¿ç”¨ç®€å•å¯†ç </p>
                    <p>â€¢ ç™»å½•åè¯·åŠæ—¶é€€å‡º</p>
                </div>
                
                <div class="info-card">
                    <h4>ğŸ“… å€Ÿé˜…ä¿¡æ¯</h4>
                    <p>å·²å€Ÿä¹¦ç±ï¼š<strong>0</strong> æœ¬</p>
                    <p>å¯å€Ÿé¢åº¦ï¼š<strong>10</strong> æœ¬</p>
                    <p>é€¾æœŸä¹¦ç±ï¼š<strong>0</strong> æœ¬</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ - æ•™å­¦æ¼”ç¤ºé¡¹ç›® | åŒ…å«SQLæ³¨å…¥æ¼æ´æ¼”ç¤º</p>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
        let users = [];
        
        // æ¨¡æ‹Ÿç³»ç»Ÿæ•°æ®
        const systemData = {
            bookCount: 12543,
            borrowCount: 892,
            activeBorrow: 356
        };
        
        // å½“å‰ç™»å½•ç”¨æˆ·
        let currentUser = null;
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°localStorage
        function saveUsersToStorage() {
            localStorage.setItem('libraryUsers', JSON.stringify(users));
        }
        
        // ä»localStorageåŠ è½½ç”¨æˆ·æ•°æ®
        function loadUsersFromStorage() {
            const savedUsers = localStorage.getItem('libraryUsers');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤ç®¡ç†å‘˜
                users = [
                    { 
                        id: 1, 
                        username: 'admin', 
                        password: 'admin123', 
                        email: 'admin@library.com',
                        role: 'ç®¡ç†å‘˜',
                        registerTime: '2024-01-01'
                    }
                ];
                saveUsersToStorage();
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message ${isSuccess ? 'success' : 'error'}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }
        
        // æ³¨å†ŒåŠŸèƒ½
        function register() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const email = document.getElementById('regEmail').value.trim();
            
            if (!username || !password || !email) {
                showMessage('registerMessage', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µï¼', false);
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (users.find(u => u.username === username)) {
                showMessage('registerMessage', 'ç”¨æˆ·åå·²å­˜åœ¨ï¼', false);
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            const newUser = {
                id: users.length + 1,
                username: username,
                password: password,
                email: email,
                role: 'æ™®é€šç”¨æˆ·',
                registerTime: new Date().toISOString().split('T')[0]
            };
            
            users.push(newUser);
            saveUsersToStorage(); // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            
            showMessage('registerMessage', 'æ³¨å†ŒæˆåŠŸï¼è¯·ä½¿ç”¨æ–°è´¦æˆ·ç™»å½•ã€‚', true);
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('regUsername').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regEmail').value = '';
        }
        
        // ç™»å½•åŠŸèƒ½ï¼ˆå­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼‰
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showMessage('loginMessage', 'è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ï¼', false);
                return;
            }
            
            // æ¨¡æ‹Ÿå­˜åœ¨SQLæ³¨å…¥æ¼æ´çš„æŸ¥è¯¢
            let loggedInUser = null;
            
            // æ¨¡æ‹ŸSQLæ³¨å…¥æ£€æµ‹
            if (username.includes("'") || username.includes("--") || username.includes("/*") || 
                username.toUpperCase().includes("OR") || username.toUpperCase().includes("AND")) {
                
                // æ£€æµ‹å¸¸è§çš„SQLæ³¨å…¥æ¨¡å¼
                if (username.includes("admin") && username.includes("' OR '")) {
                    // SQLæ³¨å…¥æˆåŠŸï¼šæ‰¾åˆ°adminç”¨æˆ·
                    loggedInUser = users.find(user => user.username === 'admin');
                } else if (username.includes("'") && username.includes("'--")) {
                    // æ³¨é‡Šç¬¦æ³¨å…¥
                    const cleanUsername = username.split("'--")[0].replace(/'/g, "");
                    loggedInUser = users.find(user => user.username === cleanUsername);
                } else if (username.includes("' OR '1'='1")) {
                    // ä¸‡èƒ½å¯†ç 
                    const cleanUsername = username.split("' OR")[0].replace(/'/g, "");
                    if (cleanUsername) {
                        loggedInUser = users.find(user => user.username === cleanUsername);
                    } else {
                        // å¦‚æœæ²¡æœ‰æŒ‡å®šç”¨æˆ·åï¼Œè¿”å›ç¬¬ä¸€ä¸ªç”¨æˆ·
                        loggedInUser = users[0];
                    }
                }
            } else {
                // æ­£å¸¸ç™»å½•éªŒè¯
                loggedInUser = users.find(user => 
                    user.username === username && user.password === password);
            }
            
            if (loggedInUser) {
                currentUser = loggedInUser;
                showMainInterface();
                showMessage('loginMessage', 'ç™»å½•æˆåŠŸï¼', true);
            } else {
                showMessage('loginMessage', 'ç™»å½•å¤±è´¥ï¼ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚', false);
            }
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }
        
        // æ˜¾ç¤ºä¸»ç•Œé¢
        function showMainInterface() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'block';
            
            // æ›´æ–°æ¬¢è¿ä¿¡æ¯
            document.getElementById('welcomeMessage').textContent = 
                `æ¬¢è¿å›æ¥ï¼Œ${currentUser.username}ï¼`;
            document.getElementById('userRole').textContent = currentUser.role;
            
            // æ›´æ–°ç³»ç»Ÿæ•°æ®
            document.getElementById('bookCount').textContent = 
                systemData.bookCount.toLocaleString();
            document.getElementById('borrowCount').textContent = 
                systemData.borrowCount.toLocaleString();
            document.getElementById('activeBorrow').textContent = 
                systemData.activeBorrow.toLocaleString();
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            currentUser = null;
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
            showMessage('loginMessage', 'å·²æˆåŠŸé€€å‡ºç™»å½•ï¼', true);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function init() {
            // åŠ è½½ä¿å­˜çš„ç”¨æˆ·æ•°æ®
            loadUsersFromStorage();
            
            // æ¨¡æ‹Ÿç³»ç»Ÿæ•°æ®æ›´æ–°
            setInterval(() => {
                if (currentUser) {
                    systemData.activeBorrow += Math.floor(Math.random() * 3) - 1;
                    systemData.activeBorrow = Math.max(0, systemData.activeBorrow);
                    
                    document.getElementById('bookCount').textContent = 
                        systemData.bookCount.toLocaleString();
                    document.getElementById('borrowCount').textContent = 
                        systemData.borrowCount.toLocaleString();
                    document.getElementById('activeBorrow').textContent = 
                        systemData.activeBorrow.toLocaleString();
                }
            }, 10000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>